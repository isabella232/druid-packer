
#CONSTANTS

## MEMORY
export TOTAL_MEM__KB=`cat /proc/meminfo | grep MemTotal | awk '{ print $2 }'`
export TOTAL_MEM_MB=`expr $TOTAL_MEM__KB / 1024`
export TOTAL_MEM_MB_Q1=`expr $TOTAL_MEM_MB / 4`
export TOTAL_MEM_MB_Q1_STR=${TOTAL_MEM_MB_Q1}m
export TOTAL_MEM_MB_Q2=`expr $TOTAL_MEM_MB / 2`
export TOTAL_MEM_MB_Q2_STR=${TOTAL_MEM_MB_Q2}m
export TOTAL_MEM_MB_10=`expr $TOTAL_MEM_MB / 10`
export TOTAL_MEM_MB_10_STR=${TOTAL_MEM_MB_10}m
export TOTAL_MEM_MB_20=`expr $TOTAL_MEM_MB / 20`
export TOTAL_MEM_MB_20_STR=${TOTAL_MEM_MB_20}m
export TOTAL_MEM_MB_40=`expr $TOTAL_MEM_MB / 40`
export TOTAL_MEM_MB_40_STR=${TOTAL_MEM_MB_40}m
## CPU
export CPU_COUNT=`nproc`
## DISC
export TOTAL_DISC_SIZE_IN_GB=${TOTAL_DISC_SIZE_IN_GB:-80}
export TOTAL_DISC_SIZE_IN_BYTES=`expr $TOTAL_DISC_SIZE_IN_GB \* 1024 \* 1024 \* 1024`
## RUNTIME
export APPROX_NUM_TREADS=`expr $CPU_COUNT - 1`
export APPROX_NUM_HTTP_TREADS=`expr $APPROX_NUM_TREADS \* 2`
export APPROX_NUM_HTTP_CONNECTIONS=$APPROX_NUM_TREADS
## HOST
export HOST_IP=${HOST_IP:-`curl http://169.254.169.254/latest/meta-data/local-ipv4`}



# SUPERVISORD CONFIGS
export SUPERVISORD_RUNDIR=${SUPERVISORD_RUNDIR:-/var/run}
export SUPERVISORD_LOGDIR=${SUPERVISORD_LOGDIR:-/var/log/druid}
export SUPERVISORD_MINFDS=${SUPERVISORD_MINFDS:-10000}
export SUPERVISORD_MINPROCS=${SUPERVISORD_MINPROCS:-200}
export SUPERVISORD_UNIX_HTTP_SERVER_FILE=${SUPERVISORD_UNIX_HTTP_SERVER_FILE:-/var/run/supervisor.sock}

# AWS CONFIG
export AWS_ACCESS_KEY=${AWS_ACCESS_KEY:-diurd}
export AWS_SECRET_KEY=${AWS_SECRET_KEY:-diurd}

# JAVA CONFIG
export JAVA_IO_TMP_DIR=${JAVA_IO_TMP_DIR:-/tmp}


# DRUID CONFIG
export DRUID_ROOT=${DRUID_ROOT:-/opt/druid}

export DRUID_STORAGE_TYPE=${DRUID_STORAGE_TYPE:-postgresql}
export DRUID_STORAGE_CONN_STR=${DRUID_STORAGE_CONN_STR:-localhost:5432/druid}
export DRUID_STORAGE_USER=${DRUID_STORAGE_USER:-druid}
export DRUID_STORAGE_PASS=${DRUID_STORAGE_PASS:-diurd}

export DRUID_PROCESSING_NUM_TREADS=${DRUID_PROCESSING_NUM_TREADS:-$APPROX_NUM_TREADS}
export DRUID_PROCESSING_BUFFER_SIZEBYTES=${DRUID_PROCESSING_BUFFER_SIZEBYTES:-1073741824}
export DRUID_SERVER_HTTP_NUM_TREADS=${DRUID_SERVER_HTTP_NUM_TREADS:-$APPROX_NUM_HTTP_TREADS}
export DRUID_SERVER_HTTP_NUM_CONNECTIONS=${DRUID_SERVER_HTTP_NUM_CONNECTIONS:-$APPROX_NUM_HTTP_CONNECTIONS}
export DRUID_WORKER_CAPACITY=${DRUID_WORKER_CAPACITY:-9}
export DRUID_SEGMENTCACHE_LOCATION=${DRUID_SEGMENTCACHE_LOCATION:-/data/druid/indexCache}

export DRUID_OVERLORD_Xmx=${DRUID_OVERLORD_Xmx:-$TOTAL_MEM_MB_Q1_STR}
export DRUID_OVERLORD_Xms=${DRUID_OVERLORD_Xms:-$TOTAL_MEM_MB_Q1_STR}
export DRUID_OVERLORD_XXNewSize=${DRUID_OVERLORD_XXNewSize:-$TOTAL_MEM_MB_40_STR}
export DRUID_OVERLORD_XXMaxNewSize=${DRUID_OVERLORD_XXMaxNewSize:-$TOTAL_MEM_MB_40_STR}

export DRUID_MIDDLEMANAGER_Xmx=${DRUID_MIDDLEMANAGER_Xmx:-$TOTAL_MEM_MB_Q1_STR}
export DRUID_MIDDLEMANAGER_Xms=${DRUID_MIDDLEMANAGER_Xms:-$TOTAL_MEM_MB_Q1_STR}

export DRUID_STORAGE_BUCKET=${DRUID_STORAGE_BUCKET:-koding-druid}
export DRUID_STORAGE_BASE_KEY=${DRUID_STORAGE_BASE_KEY:-prod/storage/v1}
export DRUID_STORAGE_ARCHIVE_BUCKET=${DRUID_STORAGE_ARCHIVE_BUCKET:-koding-druid-archive}
export DRUID_STORAGE_ARCHIVE_BASE_KEY=${DRUID_STORAGE_ARCHIVE_BASE_KEY:-$DRUID_STORAGE_BASE_KEY}

export DRUID_INDEXER_LOGS_S3_BUCKET=${DRUID_INDEXER_LOGS_S3_BUCKET:-$DRUID_STORAGE_BUCKET}
export DRUID_INDEXER_LOGS_S3_PREFIX=${DRUID_INDEXER_LOGS_S3_PREFIX:-prod/logs/v1}

export DRUID_COORDINATOR_Xmx=${DRUID_COORDINATOR_Xmx:-$TOTAL_MEM_MB_Q2_STR}
export DRUID_COORDINATOR_Xms=${DRUID_COORDINATOR_Xms:-$TOTAL_MEM_MB_Q2_STR}
export DRUID_COORDINATOR_XXNewSize=${DRUID_COORDINATOR_XXNewSize:-$TOTAL_MEM_MB_20_STR}
export DRUID_COORDINATOR_XXMaxNewSize=${DRUID_COORDINATOR_XXMaxNewSize:-$TOTAL_MEM_MB_20_STR}

export DRUID_HISTORICAL_Xmx=${DRUID_HISTORICAL_Xmx:-$TOTAL_MEM_MB_20_STR}
export DRUID_HISTORICAL_Xms=${DRUID_HISTORICAL_Xms:-$TOTAL_MEM_MB_20_STR}
export DRUID_HISTORICAL_XXNewSize=${DRUID_HISTORICAL_XXNewSize:-$TOTAL_MEM_MB_40_STR}
export DRUID_HISTORICAL_XXMaxNewSize=${DRUID_HISTORICAL_XXMaxNewSize:-$TOTAL_MEM_MB_40_STR}
export DRUID_HISTORICAL_XXMaxDirectoryMemorySize=${DRUID_HISTORICAL_XXMaxDirectoryMemorySize:-$TOTAL_MEM_MB_10_STR}

export DRUID_BROKER_PORT=${DRUID_BROKER_PORT:-8082}
export DRUID_BROKER_Xmx=${DRUID_BROKER_Xmx:-$TOTAL_MEM_MB_10_STR}
export DRUID_BROKER_Xms=${DRUID_BROKER_Xms:-$TOTAL_MEM_MB_10_STR}
export DRUID_BROKER_XXNewSize=${DRUID_BROKER_XXNewSize:-$TOTAL_MEM_MB_40_STR}
export DRUID_BROKER_XXMaxNewSize=${DRUID_BROKER_XXMaxNewSize:-$TOTAL_MEM_MB_40_STR}
export DRUID_BROKER_XXMaxDirectMemorySize=${DRUID_BROKER_XXMaxDirectMemorySize:-$TOTAL_MEM_MB_Q1_STR}
export DRUID_BROKER_RETRY_COUNT=${DRUID_BROKER_RETRY_COUNT:-3}
export DRUID_BROKER_MAXINTERMEDIATEROWS=${DRUID_BROKER_MAXINTERMEDIATEROWS:-50000}
export DRUID_BROKER_MAXRESULTS=${DRUID_BROKER_MAXRESULTS:-50000}
export DRUID_BROKER_MAXSEARCHLIMIT=${DRUID_BROKER_MAXSEARCHLIMIT:-1000}

export DRUID_REALTIME_Xmx=${DRUID_REALTIME_Xmx:-$TOTAL_MEM_MB_20_STR}
export DRUID_REALTIME_Xms=${DRUID_REALTIME_Xms:-$TOTAL_MEM_MB_20_STR}
export DRUID_REALTIME_XXNewSize=${DRUID_REALTIME_XXNewSize:-$TOTAL_MEM_MB_40_STR}
export DRUID_REALTIME_XXMaxNewSize=${DRUID_REALTIME_XXMaxNewSize:-$TOTAL_MEM_MB_40_STR}
export DRUID_REALTIME_XXMaxDirectMemorySize=${DRUID_REALTIME_XXMaxDirectMemorySize:-$TOTAL_MEM_MB_20_STR}




